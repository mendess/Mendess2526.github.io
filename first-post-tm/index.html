<!DOCTYPE html>
<html lang="en">

<head>
  
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>~mendess</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://git.mendess.xyz/css/bootstrap.min.css">
  <!-- Custom fonts for this template -->
  <link href=" https://git.mendess.xyz/css/all.min.css" rel=" stylesheet" type="text/css">

  <!-- Custom styles for this template -->
  <link rel="stylesheet" href="https://git.mendess.xyz/clean-blog.css">

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand" href="https://git.mendess.xyz/index.html">~mendess</a>
      <div>
        <ul class="navbar-nav ml-auto">
          
          <li class="nav-item">
            <a class="nav-link"
              href="https:&#x2F;&#x2F;git.mendess.xyz&#x2F;projects">Projects</a>
          </li>
          
          <li class="nav-item">
            <a class="nav-link"
              href="https:&#x2F;&#x2F;git.mendess.xyz&#x2F;about">About</a>
          </li>
          
        </ul>
      </div>
    </div>
  </nav>

  <!-- Page Header -->
  
<!-- Page Header -->

<header class="masthead" style="background-image: url('https://git.mendess.xyz/img/linux.png')">

  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <div class="post-heading">
          <h1>First Post ™</h1>
          <span class="meta"> 4 June 2020 </span>
        </div>
      </div>
    </div>
  </div>
</header>


  
<!-- Post Content -->
<article>
  <div class="container">
    <div class="row">
      <div class="col-lg-12 col-md-10 mx-auto">
        <h1 id="first-post-tm">First Post ™</h1>
<p>Test post don't upvote.</p>
<h2 id="vim-bros">Vim bros</h2>
<p>One thing I need to do for every post is put a title and a date on it in the
<em>frontmatter</em>.</p>
<p>That's annoying and easy to forget. Also if I update the post I need to change
these too.</p>
<p>Right now it has to look like this:</p>
<pre><code>+++
title = &quot;First Post ™&quot;
date = 2020-06-03
[extra]
background = &quot;linux.png&quot;
+++
</code></pre>
<p>The background image has to be put there by hand since I have no way to deduce
the image's name, if there is one from the post.</p>
<p>So I went searching and found <a href="https://vim.fandom.com/wiki/Insert_current_date_or_time">this</a>, under &quot;Automatically update
timestamps&quot;.</p>
<pre data-lang="vim" class="language-vim "><code class="language-vim" data-lang="vim">&quot; If buffer modified, update any &#x27;Last modified: &#x27; in the first 20 lines.
&quot; &#x27;Last modified: &#x27; can have up to 10 characters before (they are retained).
&quot; Restores cursor and window position using save_cursor variable.
function! LastModified()
  if &amp;modified
    let save_cursor = getpos(&quot;.&quot;)
    let n = min([20, line(&quot;$&quot;)])
    keepjumps exe &#x27;1,&#x27; . n . &#x27;s#^\(.\{,10}Last modified: \).*#\1&#x27; .
          \ strftime(&#x27;%a %b %d, %Y  %I:%M%p&#x27;) . &#x27;#e&#x27;
    call histdel(&#x27;search&#x27;, -1)
    call setpos(&#x27;.&#x27;, save_cursor)
  endif
endfun
autocmd BufWritePre * call LastModified()
</code></pre>
<p>Which is fine and all but it's not good enough just yet, first it makes a guess
the 20 is the number of lines that matter, in my case there is a better
alternative, because the zone where this matters in inside <code>+++</code> I can just
fetch these.</p>
<pre data-lang="vim" class="language-vim "><code class="language-vim" data-lang="vim">call cursor(1, 1) &quot; Put the cursor at the top
let l:st = search(&#x27;+++&#x27;, &#x27;c&#x27;) &quot; Find the line where the first +++ appears
let l:end = search(&#x27;+++&#x27;) &quot; Find the second +++
</code></pre>
<p>Then I just needed to get the current title and current date.</p>
<pre data-lang="vim" class="language-vim "><code class="language-vim" data-lang="vim">let l:title_line = search(&#x27;^#[^#]&#x27;) &quot; Get the title line
let l:title = getline(l:title_line) &quot; Get the text at that line
let l:title = substitute(l:title, &quot;^#[ ]*&quot;, &quot;&quot;, &quot;&quot;) &quot; Remove the # at the start
let l:now = strftime(&#x27;%F&#x27;) &quot; Get the current date
</code></pre>
<p>With every thing ready it was just a matter of adapting the original find and
replace, to use the correct start and end lines, <code>l:st</code> and <code>l:end</code>, as well as
the correct pattern.</p>
<pre data-lang="vim" class="language-vim "><code class="language-vim" data-lang="vim">keepjumps exe l:st . &#x27;,&#x27; . l:end . &#x27;s&#x2F;^title =.*&#x2F;title = &quot;&#x27; . l:title . &#x27;&quot;&#x2F;&#x27;
keepjumps exe l:st . &#x27;,&#x27; . l:end . &#x27;s&#x2F;^date =.*&#x2F;date = &#x27; . l:now . &#x27;&#x2F;&#x27;
</code></pre>
<p>The only other thing left to do was handle the obvious error. There might not be
any <code>+++</code> yet when I save, if I forget to add them (which I will) and for that I
just had to insert a check and create the boiler plate. This also gets around
the problem of there being random <code>+++</code> sequences in the article itself, like
this one does.</p>
<pre data-lang="vim" class="language-vim "><code class="language-vim" data-lang="vim">if l:st != 1 &quot; front matter must be at line 1
    call append(0, [&#x27;+++&#x27;,
                \ &#x27;title =&#x27;,
                \ &#x27;date = &#x27;,
                \ &#x27;#[extra]&#x27;,
                \ &#x27;#background = &quot;&quot;&#x27;,
                \ &#x27;+++&#x27;])
    let l:st = 1  &quot; I hard code these so that the find and replace
    let l:end = 6 &quot; can find this zone.
endif
</code></pre>
<p>The final code looks like this:</p>
<pre data-lang="vim" class="language-vim "><code class="language-vim" data-lang="vim">function! BlogPostModified()
    if &amp;modified
        let l:save_cursor = getpos(&quot;.&quot;)
        call cursor(1, 1)
        let l:st = search(&#x27;+++&#x27;, &#x27;c&#x27;)
        let l:end = search(&#x27;+++&#x27;)
        let l:title_line = search(&#x27;^#[^#]&#x27;)
        let l:title = getline(l:title_line)
        let l:title = substitute(l:title, &quot;^#[ ]*&quot;, &quot;&quot;, &quot;&quot;)
        let l:now = strftime(&#x27;%F&#x27;)
        if l:st != 1
            call append(0, [&#x27;+++&#x27;,
                        \ &#x27;title =&#x27;,
                        \ &#x27;date = &#x27;,
                        \ &#x27;#[extra]&#x27;,
                        \ &#x27;#background = &quot;&quot;&#x27;,
                        \ &#x27;+++&#x27;])
            let l:st = 1
            let l:end = 6
        endif
        keepjumps exe l:st . &#x27;,&#x27; . l:end . &#x27;s&#x2F;^title =.*&#x2F;title = &quot;&#x27; . l:title . &#x27;&quot;&#x2F;&#x27;
        keepjumps exe l:st . &#x27;,&#x27; . l:end . &#x27;s&#x2F;^date =.*&#x2F;date = &#x27; . l:now . &#x27;&#x2F;&#x27;
        call histdel(&#x27;search&#x27;, -1)
        call setpos(&#x27;.&#x27;, save_cursor)
    endif
endfun
autocmd BufWritePre content&#x2F;*.md call BlogPostModified()
</code></pre>
<p>Done and I never have to worry about that in my life. <em>Until the script fails...</em></p>
<h2 id="result">Result</h2>
<p><img src="https://git.mendess.xyz/first-post-tm/first_post.gif" alt="first_post_gif" /></p>

        
      </div>
    </div>
  </div>
</article>


  <hr>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <ul class="list-inline text-center">
            
            
            <li class="list-inline-item">
              <a href="https:&#x2F;&#x2F;github.com&#x2F;mendess">
                <i class="fa-stack fa-lg fab fa-github"></i>
              </a>
            </li>
            
            <li class="list-inline-item">
              <a href="https:&#x2F;&#x2F;git.mendess.xyz&#x2F;rss.xml">
                <i class="fa-stack fa-lg fas fa-rss"></i>
              </a>
            </li>
            
            
          </ul>
          </p>
        </div>
      </div>
    </div>
  </footer>
</body>

</html>
